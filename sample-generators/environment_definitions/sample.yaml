---
# Format 2

providers:
- name: ibm
  region: eu-de

resource_groups:
- name: "ibm" # will be imported via data


vpcs:
- name: access
- name: client

address_prefixes:
- name: base
  vpc: access
  region: germany
  zone: eu-de-3
  cidr: 10.90.0.0/20
### Prefixes for the client environment
- name: client-1
  vpc: client
  zone: eu-de-1
  cidr: 10.91.0.0/26
- name: client-2
  vpc: client
  zone: eu-de-2
  cidr: 10.91.0.64/26
# this one will contain the remaining 2 subnets
# + client-3
# + client-shared
# thats what the /25 is for
- name: client-3
  vpc: client
  zone: eu-de-3
  cidr: 10.91.0.128/25 

### This doesn't work. 
# We need on prefix for each zone
# - name: client-prefix
#   vpc: client
#   region: germany
#   zone: eu-de-3
#   cidr: 10.91.0.0/24


subnets:
- name: access
  vpc: access # TODO: resolve this via the prefix
  address_prefix: base
  ipv4_cidr_block: 10.90.0.192/26
  zone: eu-de-3 # TODO: resolve this via the prefix

  ### subnets for the client vpc ###
- name: client-1
  vpc: client # TODO: resolve this via the prefix
  address_prefix: client-1
  ipv4_cidr_block: 10.91.0.0/26
  zone: eu-de-1 # TODO: resolve this via the prefix
- name: client-2
  vpc: client # TODO: resolve this via the prefix
  address_prefix: client-2
  ipv4_cidr_block: 10.91.0.64/26
  zone: eu-de-2 # TODO: resolve this via the prefix
- name: client-3
  vpc: client # TODO: resolve this via the prefix
  address_prefix: client-3
  ipv4_cidr_block: 10.91.0.128/26
  zone: eu-de-3 # TODO: resolve this via the prefix
- name: client-shared
  vpc: client # TODO: resolve this via the prefix
  address_prefix: client-3
  ipv4_cidr_block: 10.91.0.192/26
  zone: eu-de-3 # TODO: resolve this via the prefix


nfs_servers:
- name: storage
  infrastructure:
    # type: vpc
    subnet: access
    primary_ipv4_address: 10.90.0.196
    profile: "cx2-2x4"
    image: ibm-redhat-8-3-minimal-amd64-3
    # keys (are hardcoded right now)
    zone: eu-de-3 # TODO: resolve this via the subnet->prefix
    vpc_name: access # TODO: resolve this via the subnet->prefix
    # bastion_host: # needed to provision this machine
  storage:
  - name: nfs-data
    profile: 10iops-tier
    size: 1000


roks:
- name: mwcluster
  kube_version: 4.6_openshift # Mandatory
  worker_flavour: bx2.16x64
  worker_count: 3
  resource_group_name: ibm
  max_worker_count: 10 # Optional, default is no maximum
  infrastructure:
    type: vpc # TODO no other otions yet
    vpc_name: client # Mandatory if type==vpc
    subnet: client-3