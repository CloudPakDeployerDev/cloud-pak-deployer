---
- name: Get secret Validate mandatory variables are defined
  assert:
    that:
      - vault_directory is defined
      - secret_group is defined
      - secret_name is defined


- name: Create directory {{ vault_directory }} if not existent
  file:
    path: "{{ vault_directory }}"
    state: directory

- set_fact:
    secret_value: "{{ lookup('ini', secret_name + ' type=properties file=' + vault_directory + '/' + secret_group) }}"

- set_fact:
    has_secret: false
  when: "secret_value == ''"

- set_fact:
    has_secret: true
  when: "not secret_value == ''"

- debug:
    msg: "Secret {{ secret_name }} lookup resulted in: {{ has_secret }}"