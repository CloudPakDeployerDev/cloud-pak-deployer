---
- name: Get secret Validate mandatory variables are defined
  assert:
    that:
      - vault_directory is defined
      - secret_group is defined
      - secret_name is defined

- name: Check that vault file {{ secret_group }} exists
  stat:
    path: "{{ vault_directory }}/{{ secret_group }}"
  register: vault_file_details

- fail:
    msg: "File {{ vault_directory }}/{{ secret_group }} does not exist"
  when: not vault_file_details.stat.exists

- set_fact:
    secret_value: "{{ lookup('ini', secret_name + ' type=properties file=' + vault_directory + '/' + secret_group) }}"

- debug:
    msg: "Secret {{ secret_group }}/{{ secret_name }} value {{ secret_value }}"