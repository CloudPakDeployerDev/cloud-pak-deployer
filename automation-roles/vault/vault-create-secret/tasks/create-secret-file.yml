---

- name: Create secret Validate mandatory variables are defined
  assert:
    that:
      - vault_directory is defined
      - secret_group is defined
      - secret_name is defined
      - secret_payload is defined

- name: Create directory {{ vault_directory }} if not existent
  file:
    path: "{{ vault_directory }}"
    state: directory

- name: Add or replace secret in file {{ vault_directory }}/{{ secret_group }}
  lineinfile:
    path: "{{ vault_directory }}/{{ secret_group }}"
    regexp: "^{{ secret_name }}"
    line: "{{ secret_name }}={{ secret_payload | b64encode }}"
    state: present
    create: True

- debug:
    msg: "Secret {{ secret_name }} successfully created on file {{ secret_group }}"