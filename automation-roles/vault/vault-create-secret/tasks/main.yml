---

- name: Validate mandatory variables are defined
  assert:
    that:
      - secret_name is defined
      - secret_payload is defined
      - secret_description is defined

- name: Login to vault if vault_login_success is not set
  include_role: 
     name: vault-connect
  when: "not vault_login_success is defined"

- name: Create Secret Vault Hashicorp
  include_role: 
    name: create-secret-hashicorp
  vars:
    secret_name: "{{ secret_name }}"
    secret_payload: "{{ secret_payload }}"
    secret_description: "{{ secret_description }}"
  when: "vault_type == 'hashicorp-vault'"

- name: Create Secret Vault IBMCloud
  include_role: 
    name: create-secret-ibmcloud
  vars:
    secret_name: "{{ secret_name }}"
    secret_payload: "{{ secret_payload }}"
    secret_description: "{{ secret_description }}"
  when: "vault_type == 'ibmcloud-vault'"

