---

- name: Validate mandatory variables are defined
  assert:
    that:
      - secret_name is defined
      - secret_payload is defined
      - secret_description is defined

- name: Login to vault if vault_login_success is not set
  include_role: 
     name: vault-connect
  when: "not vault_login_success is defined"

- name: Create secret Hashicorp vault
  block:
    - name: Login to Hashicorp vault
      include_role: 
        name: connect-vault-hashicorp
      vars:
        hashicorp_vault_address: "{{ vault_url }}"
        hashicorp_vault_login_token: "{{ vault_api_key }}"
    
  when: "vault_type == 'hashicorp-vault'"

- name: Create secret IBMCloud vault
  block:
    - name: Login to IBMCloud vault
      include_role: 
        name: connect-vault-ibmcloud
      vars:
        ibmcloud_vault_address: "{{ vault_url }}"
        ibmcloud_api_key: "{{ vault_api_key }}"
    
  when: "vault_type == 'ibmcloud-vault'" 