---
- name: Validate mandatory variables are defined
  assert:
    that:
      - secret_name is defined
      - secret_group is defined

- name: Login to vault if vault_login_success is not set
  include_role: 
     name: vault-connect
  when: "not vault_login_success is defined"

- name: Get secret in Vault Hashicorp
  include_role: 
    name: get-secret-hashicorp
  vars:
    secret_name_path: "/secret/{{ secret_group }}/{{ secret_name }}"
  when: "vault_type == 'hashicorp-vault'"

- name: Get secret in Vault IBMCloud
  include_role: 
    name: get-secret-ibmcloud
  vars:
    ibmcloud_vault_address: "{{ vault_url }}"
  when: "vault_type == 'ibmcloud-vault'"

- name: Get secret in Vault file
  include_role: 
    name: get-secret-file
  when: "vault_type == 'file-vault'"