---

- name: Create secret Validate mandatory variables are defined
  assert:
    that:
      - ibm_cloud_secret_group_id is defined
      - ibm_cloud_secret_name is defined
      - ibmcloud_vault_address is defined
      - ibm_vault_token_content is defined

- name: Get Secret {{ secret_name }} from group {{ secret_group }}
  uri:
    url: "{{ ibmcloud_vault_address }}/v1/ibmcloud/arbitrary/secrets/groups/{{ ibm_cloud_secret_group_id }}/{{ secret_id }}"
    headers:
      X-Vault-Token: "{{ ibm_vault_token_content.auth.client_token }}"
      Accept: "application/json"
    status_code: 200
  register: response_getSecret

- set_fact:
    secret_value: "{{ response_getSecret.json.data.secret_data.payload }}"

- debug:
    msg: "Secret {{ secret_name }} from group {{ secret_group }} value {{ secret_value }}"
