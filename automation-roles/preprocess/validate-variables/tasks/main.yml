---
- name: Validate mandatory variables are defined
  assert:
    that:
      - vault_type is defined
      - vault_authentication_type is defined
      - vault_url is defined
      - iaas_classic_api_key is defined
      - iaas_classic_username is defined
      - ibmcloud_api_key is defined
      - cp4d_cli_dir is defined
      - ibm_cp4d_entitlement_key is defined
      - ibm_cr_namespace is defined
      - cloud_platform is defined

- debug:
    msg: "{{ vars }}"

- debug:
    msg: "{{ vault_url }}"

- debug:
    msg: "{{ cloud_platform }}"

- set_fact:
    vault_api_key: "{{ ibmcloud_api_key }}"
- include_vars:
    file: "{{ input_dir }}/roks.yaml"
    name: roks_config

- include_vars:
    file: "{{ input_dir }}/servers.yaml"
    name: servers_config

- include_vars:
    file: "{{ input_dir }}/cp4d.yaml"
    name: cp4d_config    

- name: Validate cloud_platform is supported
  fail: msg="cloud_platform {{ cloud_platform }} only support values {{ supported_cloud_platform_types }} "
  when: "cloud_platform not in supported_cloud_platform_types"

- debug:
    msg: "{{ roks_config.roks[0] }}"
