---
- name: Validate mandatory variables are defined
  assert:
    that:
      - current_roks_cluster is defined

- include_vars:
    file: "files/worker_flavour.yaml"
    name: worker_flavours

- name: Get the worker flavour
  set_fact:
    worker_flavour_implementation_query: "{{ worker_flavours.worker_flavour | json_query(workerquery) }} "
  vars: 
    workerquery: "[? size=='{{ current_roks_cluster.worker_flavour }}'].implementation"

- debug:
    msg: "This is the selected implementation: {{ worker_flavour_implementation_query.0 }}"

- set_fact:
    current_roks_cluster: "{{ current_roks_cluster | combine('worker_flavour': worker_flavour_implementation_query[0]) }}"

- debug:
    msg: "{{ current_roks_cluster }}"

