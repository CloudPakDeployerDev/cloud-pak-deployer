---
- name: Validate mandatory variables are defined
  assert:
    that:
      - current_roks_cluster is defined


- include_vars:
    file: "files/worker_flavour.yaml"
    name: worker_flavours

- name: Set worker_flavour configuration to json
  set_fact:
    worker_flavours_json: "{{ worker_flavours.worker_flavour | to_json }}"

- debug:
    msg: "{{ worker_flavours_json | to_json }}"

- debug:
    msg: "{{current_roks_cluster.worker_flavour }}"

- name: Get the worker flavour
  set_fact:
    worker_flavour_implementation: "{{ worker_flavours_json | json_query(workerquery) }} "
  vars: 
    workerquery: "[? size == {{ current_roks_cluster.worker_flavour }}]"

- debug:
    msg: "This is the selected implementation: {{ worker_flavour_implementation }}"

