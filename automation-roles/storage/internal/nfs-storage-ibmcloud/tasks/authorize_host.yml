---
- name: Check if the host is already authorized
  shell: "ibmcloud sl file access-list {{ ibmcloud_sl_nfs_storage_id }} | grep {{ item }} | wc -l"
  register: is_host_authorized_result

- debug:
    msg: "Host {{ item }} is already authorized for NFS Storage ID {{ ibmcloud_sl_nfs_storage_id }}. Skipping..."
  when: not is_host_authorized_result.stdout == "0"

- name: Authorize host
  shell: "ibmcloud sl file access-authorize {{ ibmcloud_sl_nfs_storage_id }} -p {{ item }}"
  when: is_host_authorized_result.stdout == "0"

- debug:
    msg: "Host {{ item }} authorized for NFS Storage ID {{ ibmcloud_sl_nfs_storage_id }}"
  when: is_host_authorized_result.stdout == "0"
