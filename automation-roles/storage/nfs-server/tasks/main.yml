---

- name: Validate mandatory variables are defined
  assert:
    that:
      - cloud_platform is defined

- name: Validate cloud_platform is implemented
  fail: msg="cloud_platform {{ cloud_platform }} is not implemented, current implemented cloud platforms are {{ implemented_cloud_platform_types }} "
  when: "cloud_platform not in implemented_cloud_platform_types"

- name: Configure NFS servers IBM Cloud VPC
  include_tasks: nfs-server-ibmcloud-vpc-prepare.yaml
  loop: "{{ all_config.nfs_servers | default([]) }}"
  loop_control:
    loop_var: current_nfs_server
  when: current_nfs_server.infrastructure.type == 'vpc'

# TODO - Add steps for file server preparation (if needed here)
# - name: Configure NFS server IBM Cloud SaaS
#   block:
#     - name: Configure NFS server for IBM Cloud SaaS
#       include_role: 
#         name: nfs-server-ibmcloud-saas
#   when: cloud_platform == 'ibm-cloud' and current_nfs_server.infrastructure.type == 'saas'

