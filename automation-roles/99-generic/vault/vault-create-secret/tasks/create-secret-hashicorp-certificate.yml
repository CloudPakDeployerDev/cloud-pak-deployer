---
- name: Create secret Validate mandatory variables are defined
  assert:
    that:
      - hashicorp_vault_address is defined
      - VAULT_CERT_CA_FILE is defined
      - VAULT_CERT_KEY_FILE is defined
      - VAULT_CERT_CERT_FILE is defined
      - hashicorp_secret_name_path is defined
      - hashicorp_secret_field is defined
      - hashicorp_secret_payload is defined

- name: Create the new secret inside vault
  shell: |
    vault kv put \
      -ca-cert={{ VAULT_CERT_CA_FILE }} \
      -client-cert={{ VAULT_CERT_CERT_FILE }} \
      -client-key={{ VAULT_CERT_KEY_FILE }} \
      -address={{ hashicorp_vault_address }} \ 
      {{ hashicorp_secret_name_path }} \
      {{ hashicorp_secret_field }}={{ hashicorp_secret_payload }}
  register: hashicorp_vault_create_result

- debug:
    msg: "Secret {{ hashicorp_secret_name_path }} field {{ hashicorp_secret_field }} successfully created on Hashicorp vault"