---
- name: Get secret Validate mandatory variables are defined
  assert:
    that:
      - hashicorp_vault_address is defined
      - hashicorp_secret_name_path is defined
      - hashicorp_secret_field is defined

- name: Get the secret value
  shell: |
    vault kv get \
      -address={{ hashicorp_vault_address }} \ 
      -field={{ hashicorp_secret_field }} \
      {{ hashicorp_secret_name_path }}
  register: hashicorp_vault_get_secret_result

- set_fact:
    secret_value: "{{ hashicorp_vault_get_secret_result.stdout | b64decode }}"
  when: (vault_secret_base64 | default(True))

- set_fact:
    secret_value: "{{ hashicorp_vault_get_secret_result.stdout }}"
  when: not (vault_secret_base64 | default(True))