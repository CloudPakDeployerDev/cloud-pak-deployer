---
- name: Validate mandatory variables are defined
  assert:
    that:
      - cloud_platform is defined

- name: Validate cloud_platform is implemented
  fail: msg="cloud_platform {{ cloud_platform }} is not implemented, current implemented cloud platforms are {{ implemented_cloud_platform_types }} "
  when: "cloud_platform not in implemented_cloud_platform_types"

- name: Create downloads directory
  file:
    path: "{{ status_dir }}/downloads"
    state: directory

# Install ibmcloud and plugins
- name: Download and install ibmcloud CLI
  shell: |
    curl -fsSL {{ _ibm_cloud_cli }} | sh && \
    ibmcloud plugin install kubernetes-service -f && \
    ibmcloud plugin install container-registry -f
  args:
    warn: False

- name: Get ibmcloud CLI version
  shell: |
    ibmcloud version
  register: _ibmcloud_client_version

- name: Show ibmcloud CLI version
  debug:
    var: _ibmcloud_client_version.stdout