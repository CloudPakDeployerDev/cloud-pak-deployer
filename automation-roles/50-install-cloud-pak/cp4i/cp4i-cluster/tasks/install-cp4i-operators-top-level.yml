---

# Installation of CP4I operators using online catalog sources and 
# top level operator

# -------------------- DEFINED PROJECT ------------------------------

- name: "Install CP4I operators in namespace {{ current_cp4i_cluster.project }}"
  block:

    - debug:
        msg: "Installing CP4I operators in specific namespace"
        
    # TODO(SJ): Installing operators - top level - specific project

    # Create OperatorGroup
    # Ref: ''CP4I-install-CLI
    # ---------------------------------------------------------------
    # apiVersion: operators.coreos.com/v1
    # kind: OperatorGroup
    # metadata:
    #   name: ibm-integration-operatorgroup
    #   namespace: cp4i
    # spec:
    #   targetNamespaces:
    #   - cp4i  

  when: not _operators_in_all_namespaces

# -------------------- ALL NAMESPACES -------------------------------

- name: Install operators in all namespaces
  block:

    - name: Prepare yaml file for installing operators
      template:
        src: cp4i-operators-all-projects.j2
        dest: "{{ status_dir }}/cp4i/cp4i-operators-all-projects.yml"

    - name: Install operators from {{ status_dir }}/cp4di/cp4i-operators-all-projects.yml
      shell: |
        oc apply -f {{ status_dir }}/cp4i/cp4i-operators-all-projects.yml

  when: _operators_in_all_namespaces
