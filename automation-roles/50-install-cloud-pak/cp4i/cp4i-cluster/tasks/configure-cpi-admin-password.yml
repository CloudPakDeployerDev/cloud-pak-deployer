---
- set_fact:
    _cp4i_admin_password_vault_key_name: "cp4i_admin_{{ current_cp4i_cluster.project| replace('-','_') }}_{{ current_cp4i_cluster.openshift_cluster_name| replace('-','_') }}"

- name: Validate if an existing admin password for {{ _cp4i_admin_password_vault_key_name }} exists in the vault
  include_role: 
    name: vault-get-secret
  vars:
    secret_name: "{{ _cp4i_admin_password_vault_key_name }}"
    secret_group: "{{ environment_name }}"

- name: Save admin password retrieved from vault
  set_fact:
    _cp4i_admin_password_vault: "{{ secret_value }}"

- name: Extract admin password from OpenShift secret
  shell: |
    oc get secrets -n ibm-common-services platform-auth-idp-credentials -ojsonpath='{.data.admin_password}' | base64 -d && echo ""
  register: admin_pwd

- set_fact:
    _cp4i_admin_password_secret: "{{ admin_pwd.stdout }}"

- name: Show existing admin password from secret
  debug:
    var: _cp4i_admin_password_secret

- name: Get route to the Platform Navigator
  shell: |
    oc get PlatformNavigator {{current_cp4i_cluster.platform_navigator.instance_name}} --namespace={{current_cp4i_cluster.project}} -o json | jq -r .status.metadata.UIEndpoint
  register: pn_url

- name: Platform Navigator URL
  debug:
    var: "{{ pn_url.stdout }}"












