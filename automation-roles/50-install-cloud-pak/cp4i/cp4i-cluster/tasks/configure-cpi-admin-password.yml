---
- set_fact:
    _cp4i_admin_password_vault_key_name: "cp4i_admin_{{ current_cp4i_cluster.project| replace('-','_') }}_{{ current_cp4i_cluster.openshift_cluster_name| replace('-','_') }}"

- name: Validate if an existing admin password for {{ _cp4i_admin_password_vault_key_name }} exists in the vault
  include_role: 
    name: vault-get-secret
  vars:
    secret_name: "{{ _cp4i_admin_password_vault_key_name }}"
    secret_group: "{{ environment_name }}"

- name: Save admin password retrieved from vault
  set_fact:
    _cp4i_admin_password_vault: "{{ secret_value }}"

- name: Extract admin password from OpenShift secret
  shell: |
    oc get secrets -n ibm-common-services platform-auth-idp-credentials -ojsonpath='{.data.admin_password}' | base64 -d && echo ""
  register: _cp4d_admin_password_secret

- name: Show existing admin password from secret
  debug:
    var: _cp4d_admin_password_secret

# - name: Get route to Cloud Pak for Data
#   shell: |
#     oc --namespace {{ current_cp4d_cluster.project }} get route -l component=ibm-nginx \
#       -o jsonpath="{.items[0].spec.host}"
#   register: cp4d_url












