---
- name: List directories under {{ _p_case_dir }}
  find:
    paths: "{{ _p_case_dir }}"
    file_type: directory
    recurse: True
  register: _case_directories

- name: Filter images not matching processor architecture {{ _p_processor_arch }}
  shell: |
    python3 /opt/ansible/ansible-play/roles/utils/files/image-csv-trim.py \
      {{ _filter_case_dir.path }} {{ _p_processor_arch }}
  loop: "{{ _case_directories.files | default([]) }}"
  loop_control:
    loop_var: _filter_case_dir