---
- debug:
    msg: "Validating dependency {{ _current_cartridge_dependent_component }}"

- name: Validate dependency {{ _current_cartridge_dependent_component }} is defined as a cp4d cartridge
  set_fact:
    _cartridge_dependent_details: "{{ _p_current_cp4d_cluster.cartridges | json_query(jmes_query) }}"
  vars:
    jmes_query: "[?name == '{{ _current_cartridge_dependent_component }}']"

- name: Fail when dependent cartridge is not specified in the cp4d catridges
  fail:
    msg: "Missing dependent cartridge {{ _current_cartridge_dependent_component }}. This component must be configured in the cp4d configuration"
  when: _cartridge_dependent_details | length == 0