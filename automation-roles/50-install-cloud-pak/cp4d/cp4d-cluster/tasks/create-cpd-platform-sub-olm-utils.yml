---
# Create Foundational Services project for Cloud Pak for Data
- name: Create OpenShift Project {{ foundational_services_project }} if it does not exist
  shell: 
    oc new-project {{ foundational_services_project }} || true

# Create Operator Group
- name: Generate definition for OperatorGroup
  template:
    src: operator-group.j2
    dest: "{{ status_dir }}/cp4d/operator-group.yml"

- name: Create OperatorGroup
  command: |
    oc apply -f "{{ status_dir }}/cp4d/operator-group.yml"

- name: Ensure that OLM utils work directory exists
  file:
    path: /tmp/work
    state: directory

- name: Generate OLM command to create platform operator
  set_fact:
    _apply_olm_command: "{{ lookup('template', 'apply-olm-cpd-platform-sub.j2') }}" 

- name: Show apply-olm command to create platform operator
  debug:
    var: _apply_olm_command

- name: Run apply-olm command to create platform operator, logs are in {{ status_dir }}/log/{{ current_cp4d_cluster.project }}-apply-olm-cpd-platform-sub.log
  shell: |
    {{ _apply_olm_command }} > {{ status_dir }}/log/{{ current_cp4d_cluster.project }}-apply-olm-cpd-platform-sub.log 2>&1