---
- debug:
    var: _current_cp4d_cartridge

- debug:
    var: current_cp4d_cluster

- name: Prepare yaml file for network policy 
  template:
    src: cpd-network-policy.j2
    dest: "{{ status_dir }}/cp4d/ccpd-network-policy-{{ current_cp4d_cluster.project }}.yml"
  when: _current_cp4d_cartridge.name == "watson-discovery" and current_cp4d_cluster.cp4d_version >= "4.5.0"

- name: Create Network Policy
  shell: |
    oc apply -f {{ status_dir }}/cp4d/ccpd-network-policy-{{ current_cp4d_cluster.project }}.yml
  when: _current_cp4d_cartridge.name == "watson-discovery"  and current_cp4d_cluster.cp4d_version >= "4.5.0"