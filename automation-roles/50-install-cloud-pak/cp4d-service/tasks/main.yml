# tasks file for cp4d-cluster
- debug:
    msg: "Handling CP4D cartridge {{ current_cp4d_cartridge.name }} for CP4D cluster {{ current_cp4d_cluster.project }}"

- name: Install service {{ current_cp4d_cartridge.name  }} for CP4D 3.5
  include_tasks: cp4d-service-35.yml
  when: (current_cp4d_cluster.cp4d_version | default('3.5') | string ) == '3.5'

- name: Install service {{ current_cp4d_cartridge.name  }} for CP4D 4.0
  include_tasks: cp4d-service-40.yml
  when: (current_cp4d_cluster.cp4d_version | default('3.5') | string ) != '3.5'

- name: Configure CP4D admin password and store in vault
  include_tasks: configure-cpd-admin-password.yml
  when: cp4d_configure_cpd_admin == 0

- name: Provision Data Virtualization instance if service dv is requested
  block:
    - name: Run Data Virtualization instance playbook
      include_role:
        name: provision_dv_instance
  when: current_cp4d_cartridge.name != None and current_cp4d_cartridge.name == 'dv'

- name: Provision Cognos instance if service ca is requested
  block:
    - name: Run Cognos Analytics instance playbook
      include_role:
        name: provision_cognos_instance
  when: current_cp4d_cartridge.name != None and current_cp4d_cartridge.name == 'ca'

