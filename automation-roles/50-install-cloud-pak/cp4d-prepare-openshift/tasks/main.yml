---
- name: Validate mandatory variables are defined
  assert:
    that:
      - cloud_platform is defined

- name: Validate cloud_platform is implemented
  fail: msg="cloud_platform {{ cloud_platform }} is not implemented, current implemented cloud platforms are {{ implemented_cloud_platform_types }} "
  when: "cloud_platform not in implemented_cloud_platform_types"

- name: Make a temporary work folder available
  tempfile:
    state: directory
  register: cp4d_automation_temp_dir

- name: Login to the OpenShift cluster
  include_role:
    name: openshift-login
  vars: 
    openshift_cluster_name: "{{ current_cp4d_cluster.openshift_cluster_name }}"

- name: Prepare cluster-wide configuration for Cloud Pak for Data on IBM Cloud
  include_tasks: ibmcloud-cp4d-prepare-openshift.yml
  when: "cloud_platform == 'ibm-cloud'"

- name: Prepare cluster-wide configuration for Cloud Pak for Data
  include_tasks: cp4d-prepare-openshift.yml
  when: "cloud_platform != 'ibm-cloud'"