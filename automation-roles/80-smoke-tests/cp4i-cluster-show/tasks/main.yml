---

# TODO(SJ): (Optional) Change implementation
# ---------------------------------------------------
# CP4D version of Deployer downloads and installs
# the OpenShift client here as well as logs in
# to the cluster. The role tasks can thereforebe 
# used indepentently. 

# In the current implementation we will assume 
# that those tasks are called from cp4i-cluster role.

- name: Extract admin password from OpenShift secret
  shell: |
    oc get secrets -n ibm-common-services platform-auth-idp-credentials -ojsonpath='{.data.admin_password}' | base64 -d && echo ""
  register: admin_pwd

- name: Get route to the Platform Navigator
  shell: |
    oc get PlatformNavigator {{current_cp4i_cluster.platform_navigator.instance_name}} --namespace={{current_cp4i_cluster.project}} -o json | jq -r .status.metadata.UIEndpoint
  register: pn_url

- name: Make sure that directory {{ status_dir }}/cloud-paks exists
  file:
    path: "{{ status_dir }}/cloud-paks"
    state: directory

- name: Store CP4I Platform Navigator into log file
  copy:
    content: |
      aaa
      bbb
      ccc
    dest: "{{ status_dir }}/cloud-paks/cp4i-{{ current_cp4i_cluster.openshift_cluster_name }}-{{ current_cp4i_cluster.project }}-PN-access.txt"

