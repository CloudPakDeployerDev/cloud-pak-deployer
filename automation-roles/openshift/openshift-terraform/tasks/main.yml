---
- name: Validate mandatory variables are defined
  assert:
    that:
      - cloud_platform is defined

- name: Validate cloud_platform is implemented
  fail: msg="cloud_platform {{ cloud_platform }} is not implemented, current implemented cloud platforms are {{ implemented_cloud_platform_types }} "
  when: "cloud_platform not in implemented_cloud_platform_types"

- name: OpenShift Terraform for IBM Cloud
  block:
    - name: Provision OpenShift on IBM Cloud Classic Infrastructure
      include_role: 
        name: ibmcloud-terraform-classic
      when: roks_config.roks[0].infrastructure.type == "classic"
  when: "cloud_platform == 'ibm-cloud'"

    
- name: Provision OpenShift on IBM Cloud VPC Infrastructure
   include_role: 
      name: ibmcloud-terraform-vpc
    when: roks_config.roks[0].infrastructure.type == "vpc"
  when: "cloud_platform == 'ibm-cloud'"

- name: Store the Terraform tfstate file in the vault
  include_role: 
    name: terraform-store-state
  var:
    roks_name: "{{ roks_config.roks[0].name }}"