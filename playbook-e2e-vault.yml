---
- name: Run Infrastructure automation
  hosts: localhost
  connection: local
  become: True
  gather_facts: False

  roles:
    - role: vault-connect

  tasks:
  - name: Validate if the key testkey exist in the vault
    include_role: 
      name: vault-has-secret
    vars:
      secret_name: "testkey"
      secret_group: "testgroup"    
      secret_field: "value"

  - name: Create secret
    include_role: 
      name: vault-create-secret
    vars:
      secret_name: "testkey1"
      secret_group: "testgroup"    
      secret_field: "value"
      secret_payload: "This is the very secret value!"

  - name: Get secret
    include_role: 
      name: vault-get-secret
    vars:
      secret_name: "testkey1"
      secret_group: "testgroup"    
      secret_field: "value"

  - name: Delete secret
    include_role: 
      name: vault-delete-secret
    vars:
      secret_name: "testkey1"
      secret_group: "testgroup"    
      secret_field: "value"
