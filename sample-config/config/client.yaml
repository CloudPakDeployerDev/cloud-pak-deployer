---
# Format 2

providers:
- name: ibm
  region: eu-de

resource_groups:
- name: "ibm" # will be imported via data


vpcs:
- name: client
  allow_inbound: ['ssh','ldaptcp']


security_rules:
- name: ssh
  tcp: {port_min: 22, port_max: 22}
- name: ldaptcp
  tcp: {port_min: 636, port_max: 636} 



transit_gateways:
- name: client-gateway
  location: eu-de
  connections:
  - vpc: client 

ssh_keys:
- name: sample-provision-ssh
  managed: True 
  # the vault in charge for the key
  # we just take the value from there



# define ips here if you want to preserve them
# otherwise they will be removed when the attached resource 
# are getting deleted

# TODO: postponed for later implementation

# floating_ips: 
# - name: bastion
#   zone: eu-de-3


address_prefixes:
### Prefixes for the client environment
- name: zone-1
  vpc: client
  zone: eu-de-1
  cidr: 10.91.0.0/26
- name: zone-2
  vpc: client
  zone: eu-de-2
  cidr: 10.91.0.64/26
# this one will contain the remaining 2 subnets
# + client-3
# + client-shared
# thats what the /25 is for
- name: zone-3
  vpc: client
  zone: eu-de-3
  cidr: 10.91.0.128/25 

### This doesn't work. 
# We need on prefix for each zone
# - name: client-prefix
#   vpc: client
#   region: germany
#   zone: eu-de-3
#   cidr: 10.91.0.0/24


subnets:
  ### subnets for the client vpc ###
- name: subnet-zone-1
  vpc: client # TODO: resolve this via the prefix
  address_prefix: zone-1
  ipv4_cidr_block: 10.91.0.0/26
  zone: eu-de-1 # TODO: resolve this via the prefix
- name: subnet-zone-2
  vpc: client # TODO: resolve this via the prefix
  address_prefix: zone-2
  ipv4_cidr_block: 10.91.0.64/26
  zone: eu-de-2 # TODO: resolve this via the prefix
- name: subnet-zone-3
  vpc: client # TODO: resolve this via the prefix
  address_prefix: zone-3
  ipv4_cidr_block: 10.91.0.128/26
  zone: eu-de-3 # TODO: resolve this via the prefix
- name: subnet-shared
  vpc: client # TODO: resolve this via the prefix
  address_prefix: zone-3
  ipv4_cidr_block: 10.91.0.192/26
  zone: eu-de-3 # TODO: resolve this via the prefix

vsis:
- name: bastion
  infrastructure:
    keys:
    - "sample-provision-ssh"
    image: ibm-redhat-8-3-minimal-amd64-3
    profile: "cx2-2x4"
    vpc_name: client
    zone: eu-de-3
    subnet: subnet-shared
    primary_ipv4_address: 10.91.0.196
    public_ip: True

nfs_servers:
- name: storage
  infrastructure:
    subnet: subnet-shared
    primary_ipv4_address: 10.91.0.197
    profile: "cx2-2x4"
    image: ibm-redhat-8-3-minimal-amd64-3
    keys:
    - "sample-provision-ssh"
    zone: eu-de-3 # TODO: resolve this via the subnet->prefix
    vpc_name: client # TODO: resolve this via the subnet->prefix
    bastion_host: bastion
  storage:
  - name: nfs-data
    profile: 10iops-tier
    size: 1000

nfs_servers:
- name: storage
  infrastructure:
    # type: vpc
    subnet: access
    primary_ipv4_address: 10.90.0.196
    profile: "cx2-2x4"
    image: ibm-redhat-8-3-minimal-amd64-3
    # keys (are hardcoded right now)
    zone: eu-de-3 # TODO: resolve this via the subnet->prefix
    vpc_name: access # TODO: resolve this via the subnet->prefix
    # bastion_host: # needed to provision this machine
  storage:
  - name: nfs-data
    profile: 10iops-tier
    size: 1000

roks:
- name: sample
  kube_version: 4.6_openshift # Mandatory
  worker_flavour: bx2.16x64
  worker_count: 3
  resource_group_name: ibm
  max_worker_count: 10 # Optional, default is no maximum
  infrastructure:
    type: vpc # TODO no other otions yet
    vpc_name: client # Mandatory if type==vpc
    subnet: client-3
    zone: eu-de-3
  storage_classes:
  - storage_type: nfs
    nfs_server_name: nfs

cp4ds:
- project: zen-sample            # Mandatory
  openshift_cluster_name: sample-roks   # Mandatory, references the ROKS cluster that was defined
  container_registry_namespace: roks-cpd-354  # Mandatory, references the ibm container registry namespace definition
  cartridges:
  - name: lite             # Mandatory, indicates the cartridge to be installed
    version: 3.5.0.0            # Optional, taken from defaults if not specified
    size: medium                # Optional, taken from defaults if not specified
