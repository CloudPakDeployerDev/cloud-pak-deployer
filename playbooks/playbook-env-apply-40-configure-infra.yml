---
- name: 40 - Configure infrastructure
  hosts: localhost
  connection: local
  become: True
  gather_facts: False

  vars:
    ansible_callback_diy_playbook_on_task_start_msg: ""
    ansible_callback_diy_runner_on_skipped_msg: ""
    ansible_callback_diy_runner_on_ok_msg: ""

  tasks:
  - name: Assemble NFS Servers group
    include_role:
      name: nfs-server

- name: 40 - Configure infrastructure - Bastion servers
  hosts: vpc_bastion_server
  become: True
  gather_facts: False

  vars:
    ansible_callback_diy_playbook_on_task_start_msg: ""
    ansible_callback_diy_runner_on_skipped_msg: ""
    ansible_callback_diy_runner_on_ok_msg: ""

  roles:
    - role: nfs-server-ibmcloud-vpc-bastion

- name: 40 - Configure infrastructure - NFS servers
  hosts: vpc_nfs_servers
  become: True
  gather_facts: False

  vars:
    ansible_callback_diy_playbook_on_task_start_msg: ""
    ansible_callback_diy_runner_on_skipped_msg: ""
    ansible_callback_diy_runner_on_ok_msg: ""

  roles:
    - role: nfs-server-ibmcloud-vpc-install

- name: 40 - Configure infrastructure - Configure OpenShift
  hosts: localhost
  connection: local
  become: True
  environment:
    KUBECONFIG: "{{ status_dir }}/openshift/kubeconfig"

  vars:
    # ansible_callback_diy_playbook_on_task_start_msg: ""
    ansible_callback_diy_runner_on_skipped_msg: ""
    ansible_callback_diy_runner_on_ok_msg: ""

  tasks:
  - name: Configure ROKS cluster
    include_role:
      name: roks-cluster
    loop: "{{ all_config.roks | default([]) }}"
    loop_control:
      loop_var: current_roks_cluster
