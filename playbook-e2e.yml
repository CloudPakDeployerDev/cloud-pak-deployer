---
- name: Run Automation
  hosts: localhost
#  environment:
#    VAULT_ADDR: "{{ vault_url }}"
#    VAULT_TOKEN: "{{ vault_api_key }}"
  connection: local
  become: True
 
  tasks:
  - name: Print some debug information 
    vars: 
      msg: |
        Module Variables ("vars"):
        --------------------------------
        {{ vars | to_nice_json }} 
        
        Environment Variables ("environment"):
        --------------------------------
        {{ environment | to_nice_json }} 
        
        GROUP NAMES Variables ("group_names"):
        --------------------------------
        {{ group_names | to_nice_json }}
        
        GROUPS Variables ("groups"):
        --------------------------------
        {{ groups | to_nice_json }}
        
        HOST Variables ("hostvars"):
        --------------------------------
        {{ hostvars | to_nice_json }} 
  
    debug: 
      msg: "{{ msg.split('\n') }}"       
    tags: debug_info

  roles:
    - role: validate-variables
    - role: vault-connect
    - role: openshift-terraform
    - role: cli-installs
    - role: login-ibmcloud

  tasks:
  - name: Loop through each cp4d entry
    include_role:
      name: cp4d-cluster
    loop: "{{ cp4d_config.cp4d }}"
    loop_control:
      loop_var: current_cp4d_cluster