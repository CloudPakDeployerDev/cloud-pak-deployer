---
title: OpenShift configuration
tabs:
  [
    "Objects",
    "Vault",
    "Infrastructure",
    "OpenShift",
    "Cloud Paks",
    "Cartridges",
    "Configuration",
    "Other",
  ]
---

# OpenShift configuration

### `openshift`

For OpenShift, there are 3 flavours:

- [OpenShift on IBM Cloud](#openshift-on-ibm-cloud)
- [OpenShift on Microsoft Azure (ARO)](<#openshift-on-microsoft-azure-(aro)>)
- [OpenShift on vSphere](#openshift-on-vsphere)
- [Existing OpenShift](#existing-openshift)

When running the Cloud Pak Deployer for IBM Cloud, the ROKS cluster will be provisioned and managed by Terraform. For existing OpenShift clusters, other parameters must be specified to identify the cluster on which the Cloud Pak(s) must be deployed. Below we will show 2 examples.

### OpenShift on IBM Cloud (ROKS)

```
openshift:
- name: sample
  ocp_version: 4.6
  worker_flavour: bx2.16x64
  number_of_workers: 2
  max_number_of_workers: 10
  resource_group_name: ibm
  infrastructure:
    type: vpc
    vpc_name: sample
    subnets:
    - sample-subnet-zone-1
    - sample-subnet-zone-2
    - sample-subnet-zone-3
  openshift_storage:
  - storage_name: nfs-storage
    storage_type: nfs
    nfs_server_name: sample-nfs
  - storage_type: ocs
    ocs_storage_label: ocs
    ocs_storage_size: 500Gi
```

#### Property explanation OpenShift clusters on IBM Cloud (ROKS)

| Property                            | Description                                                                                                           | Mandatory                      | Allowed values         |
| ----------------------------------- | --------------------------------------------------------------------------------------------------------------------- | ------------------------------ | ---------------------- |
| name                                | Name of the OpenShift cluster                                                                                         | Yes                            |                        |
| ocp_version                         | ROKS Kubernetes version                                                                                               | Yes                            | 4.6                    |
| worker_flavour                      | Type of worker to be used                                                                                             | Yes                            | [link]                 |
| number_of_workers                   | Total number of workers. This must be a factor of the number of subnets                                               | Yes                            | Integer                |
| max_number_of_workers               | Maximum number of workers allowed. If total number of workers exceeds this value, the cluster will not be provisioned | Yes                            | Integer                |
| resource_group_name                 | IBM Cloud resource group for the ROKS cluster                                                                         | Yes, inferred                  |                        |
| infrastructure.type                 | Type of infrastructure to provision ROKS cluster on                                                                   | No                             | vpc (default), classic |
| infrastructure.vpc_name             | Name of the VPC if type is `vpc`                                                                                      | Yes, inferrred                 | Existing VPC           |
| infrastructure.subnets              | List of subnets within the VPC to use. Either 1 or 3 subnets must be specified                                        | Yes                            | Existing subnet        |
| openshift_storage.storage_type      | Type of storage class to create in the OpenShift cluster                                                              | Yes                            | nfs or ocs             |
| openshift_storage.nfs_server_name   | Name of the NFS server within the VPC                                                                                 | Yes if `storage_type` is `nfs` | Existing `nfs_server`  |
| openshift_storage.ocs_storage_label | Label to be used for the dedicated OCS nodes in the cluster                                                           | Yes if `storage_type` is `ocs` |                        |
| openshift_storage.ocs_storage_size  | Size of the OCS storage in Gibibytes (Gi)                                                                             | Yes if `storage_type` is `ocs` |                        |

### OpenShift on Microsoft Azure (ARO)

<InlineNotification kind="warning">
  WIP - TODO: "openshift_storage" is still yet to be designed/developed
</InlineNotification>

```
openshift:
- name: sample
  azure_aro_name: sample
  domain_name: example
  network:
    pod_cidr: "10.128.0.0/14"
    service_cidr: "172.30.0.0/16"
  # openshift_storage:
  # - storage_name: nfs-storage
  #   storage_type: nfs
  #   nfs_server_name: sample-nfs
  # - storage_name: ocs-storage
  #   storage_type: ocs
  #   ocs_storage_label: ocs
  #   ocs_storage_size_gb: 512
  #   ocs_dynamic_storage_class: thin
```

#### Property explanation for OpenShift cluster on Microsoft Azure (ARO)

| Property             | Description                                                                                                                                                                                                                             | Mandatory | Allowed values                      |
| -------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | ----------------------------------- |
| name                 | Name of the OpenShift cluster                                                                                                                                                                                                           | Yes       |                                     |
| azure_aro_name       | Name of the `azure_aro` infrastructure object                                                                                                                                                                                           | Yes       |                                     |
| domain_name          | A random unique alphabetic string that is used as a part of the full domain address, i.e. for the `westeurope` location the console URL will be: `https://console-openshift-console.apps.<domain_name>.westeurope.aroapp.io/dashboards` | Yes       |                                     |
| network              | Cluster network attributes                                                                                                                                                                                                              | Yes       |                                     |
| network.pod_cidr     | CIDR of pod network                                                                                                                                                                                                                     | Yes       | Must be a minimum of /18 or larger. |
| network.service_cidr | CIDR of service network                                                                                                                                                                                                                 | Yes       | Must be a minimum of /18 or larger. |

### OpenShift on vSphere

```
openshift:
- name: sample
  domain_name: example.com
  vsphere_name: sample
  ocp_version: 4.6
  number_of_masters: 3
  master_vm_definition: master
  number_of_workers: 3
  worker_vm_definition: worker
  max_number_of_workers: 10
  api_vip: 10.99.92.51
  ingress_vip: 10.99.92.52
  openshift_storage:
  - storage_name: nfs-storage
    storage_type: nfs
    nfs_server_name: sample-nfs
  - storage_name: ocs-storage
    storage_type: ocs
    ocs_storage_label: ocs
    ocs_storage_size_gb: 512
    ocs_dynamic_storage_class: thin
```

#### Property explanation OpenShift clusters on IBM Cloud (ROKS)

| Property                                    | Description                                                                                                                        | Mandatory                      | Allowed values           |
| ------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- | ------------------------------ | ------------------------ |
| name                                        | Name of the OpenShift cluster                                                                                                      | Yes                            |                          |
| domain_name                                 | Domain name of the cluster, this will also depict the route to the API and ingress endpoints                                       | Yes                            |                          |
| ocp_version                                 | OpenShift version version, the value specified here will also be used for OpenShift Container Storage                              | Yes                            |                          |
| number_of_masters                           | Total number of masters, typically 3                                                                                               | Yes                            | Integer                  |
| master_vm_definition                        | `vm_definition` object that will be used to define number of vCPUs and memory for the master nodes                                 | Yes                            | Existing `vm_definition` |
| number_of_workers                           | Total number of workers                                                                                                            | Yes                            | Integer                  |
| worker_vm_definition                        | `vm_definition` object that will be used to define number of vCPUs and memory for the worker nodes                                 | Yes                            | Existing `vm_definition` |
| max_number_of_workers                       | Maximum number of workers allowed. If total number of workers exceeds this value, the cluster will not be provisioned              | Yes                            | Integer                  |
| api_vip                                     | Virtual IP address that the installer will provision for the API server                                                            | Yes                            |                          |
| ingress_vip                                 | Virtual IP address that the installer will provision for the ingress server                                                        | Yes                            |                          |
| openshift_storage.storage_type              | Type of storage class to create in the OpenShift cluster                                                                           | Yes                            | nfs or ocs               |
| openshift_storage.nfs_server_name           | Name of the NFS server within the VPC                                                                                              | Yes if `storage_type` is `nfs` | Existing `nfs_server`    |
| openshift_storage.ocs_storage_label         | Label to be used for the dedicated OCS nodes in the cluster                                                                        | Yes if `storage_type` is `ocs` |                          |
| openshift_storage.ocs_storage_size_gb       | Size of the OCS storage in Gibibytes (Gi)                                                                                          | Yes if `storage_type` is `ocs` |                          |
| openshift_storage.ocs_dynamic_storage_class | Storage class that will be used for provisioning OCS. On vSphere clusters, `thin` i usually available after OpenShift installation | Yes if `storage_type` is `ocs` |                          |

### Existing OpenShift

When using the Cloud Pak Deployer on an existing OpenShift cluster, the scripts assume that the cluster is already operational and that any storage classes have been pre-created. The deployer accesses the cluster through a vault secret with the kubeconfig information; the name of the secret is `<name>-kubeconfig`.

```
openshift:
- name: sample
  ocp_version: 4.6
  cluster_name: sample
  domain_name: example.com
  openshift_storage:
  - storage_name: nfs-storage
    storage_type: nfs
    # ocp_storage_class_file: nfs-client
    # ocp_storage_class_block: nfs-client
```

#### Property explanation for existing OpenShift clusters

| Property                                  | Description                                                                         | Mandatory | Allowed values |
| ----------------------------------------- | ----------------------------------------------------------------------------------- | --------- | -------------- |
| name                                      | Name of the OpenShift cluster                                                       | Yes       |                |
| ocp_version                               | OpenShift version of the cluster (not used for now)                                 | No        | 4.6            |
| cluster_name                              | Name of the cluster (part of the FQDN)                                              | Yes       |                |
| domain_name                               | Domain name of the cluster (part of the FQDN)                                       | Yes       |                |
| openshift_storage.name                    | Name of the storage definition, to be referenced by the Cloud Pak                   | Yes       |                |
| storage_classes.storage_type              | Type of storage class to use in the OpenShift cluster                               | Yes       | nfs, ocs       |
| openshift_storage.ocp_storage_class_file  | OpenShift storage class to use for file storage, defaults to `managed-nfs-storage`  | No        |                |
| openshift_storage.ocp_storage_class_block | OpenShift storage class to use for block storage, defaults to `managed-nfs-storage` | No        |                |
