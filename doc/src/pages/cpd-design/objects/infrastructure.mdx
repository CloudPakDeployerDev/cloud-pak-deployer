---
title: Infrastructure configuration
tabs: ['Objects', 'Vault', 'Infrastructure', 'OpenShift', 'Cloud Paks', 'Cartridges', 'Configuration', 'Other']
---

# Infrastructure configuration
Infrastructure definitions depend on the cloud provider that is used for the provisioning.

There are 3 cloud providers for the objects:
* [IBM Cloud](#ibm-cloud)
* [vSphere](#vsphere)
* [Existing OpenShift](#existing-openshift)

## IBM Cloud

For IBM Cloud, the following object types are supported:
* [provider](#ibm-cloud-provider)
* [resource_group](#ibm-cloud-resource_group)
* [ssh_keys](#ibm-cloud-ssh_keys)
* [address_prefix](#ibm-cloud-address_prefix)
* [subnet](#ibm-cloud-subnet)
* [vsi](#ibm-cloud-vsi)
* [transit_gateway](#ibm-cloud-transit_gateway)
* [nfs_server](#ibm-cloud-nfs_server)
* [serviceid](#serviceid)
* [cos](#cos)

### IBM Cloud `provider`
Defines the provider that Terraform will use for managing the IBM Cloud assets.
```
provider:
- name: ibm
  region: eu-de
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the provider cluster                                         | Yes       | ibm |
| region   | Region to connect to                                                 | Yes       | Any IBM Cloud region  |


### IBM Cloud `resource_group`
The resource group is for cloud asset grouping purposes. You can define multiple resource groups in your IBM cloud account to group the provisioned assets. If you do not need to group your assets, choose `default`.

```
resource_group:
- name: default
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the existing resource group                                  | Yes       |  |


### IBM Cloud `ssh_keys`
SSH keys to connect to VSIs. If you have Virtual Server Instances in your VPC, you will need an SSH key to connect to them. SSH keys defined here will be looked up in the vault and created if they don't exist already.

```
ssh_keys:
- name: vsi-access
  managed: True
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the SSH key in IBM Cloud                                     | Yes       |  |
| managed  | Determines if the SSH key will be created if it doesn't exist        | No        | true (default), false |


### IBM Cloud `security_rule`
Defines the services (or ports) which are allowed within the context of a VPC and/or VSI.

```
security_rule:
- name: https
  tcp: {port_min: 443, port_max: 443}
- name: ssh
  tcp: {port_min: 22, port_max: 22}
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the security rule                                            | Yes       |  |
| tcp      | Range of tcp ports (`port_min` and `port_max`) to allow              | tcp and/or udp |  |
| udp      | Range of udp ports (`port_min` and `port_max`) to allow              | tcp and/or udp |  |


### IBM Cloud `vpc`
Defines the virtual private cloud which groups the provisioned objects (including VSIs and OpenShift cluster).

```
vpc:
- name: sample
  allow_inbound: ['ssh', 'https']
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the Virtual Private Cloud                                    | Yes       |  |
| managed  | Controls whether the VPC is managed. The default is `True`. Only set to `False` if the VPC is not managed but only referenced by other objects such as transit gateways. | No | True (default), False |
| allow_inbound | Security rules which are allowed for inbound traffic            | No | Existing `security_rule`s |


### IBM Cloud `address_prefix`
Defines the zones used within the VPC, along with the subnet the addresses will be issued for.

```
- name: sample-zone-1
  vpc: sample
  zone: eu-de-1
  cidr: 10.27.0.0/26
- name: sample-zone-2
  vpc: sample
  zone: eu-de-2
  cidr: 10.27.0.64/26
- name: sample-zone-3
  vpc: sample
  zone: eu-de-3
  cidr: 10.27.0.128/26
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the zone                                                     | Yes       |  |
| zone     | Zone in the IBM Cloud                                                | Yes       |  |
| cidr     | Address range that IPs in this zone will fall into                   | Yes       |  |
| vpc      | Virtual Private Cloud this address prefix belongs to                 | Yes, inferred |  |


### IBM Cloud `subnet`
Defines the subnet that Virtual Server Intances and ROKS workers will be attached to.

```
subnet:
- name: sample-subnet-zone-1
  address_prefix: sample-zone-1
  ipv4_cidr_block: 10.27.0.0/26
  zone: eu-de-1
  vpc: sample
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the subnet                                                   | Yes       |  |
| address_prefix | Zone this subnet belongs to                                    | Yes       | Existing zone |
| ipv4_cidr_block | Address range that IPs in this subnet will fall into          | Yes       | Range of subrange of zone |
| zone     | Zone of the address prefix definition                                | Yes, inferred |  |
| vpc      | Virtual Private Cloud this subnet prefix belongs to                  | Yes, inferred from zone |  |


### IBM Cloud `vsi`
Defines a Virtual Server Instance within the VPC.

```
vsi:
- name: sample-bastion
  infrastructure:
    keys:
    - "vsi-access"
    image: ibm-redhat-8-3-minimal-amd64-3
    subnet: sample-subnet-zone-1
    primary_ipv4_address: 10.27.0.4
    public_ip: True
    vpc_name: sample
    zone: eu-de-3
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the Virtual Server Instance                                  | Yes       |  |
| infrastructure | Infrastructure attributes                                      | Yes       |  |
| infrastructure.allow_ip_spoofing | Decide if IP spoofing is allowed for the interface or not | No | False (default), True  |
| infrastructure.keys | List of SSH keys to attach to the VSI                     | Yes       | Existing `ssh_key` |
| infrastructure.image | Operating system image to be used                        | Yes | Existing image in IBM Cloud |
| infrastructure.subnet | Subnet the VSI will be connected to                     | Yes | Existing `subnet` |
| infrastructure.primary_ipv4_address | IP v4 address that will be assigned to the VSI | No | If specified, address in the `subnet` range  |
| infrastructure.public_ip | Must a public IP address be attached to this VSI? | No | False (default), True |
| infrastructure.vpc_name | Virtual Private Cloud this VSI belongs to              | Yes, inferred from subnet |  |
| infrastructure.zone | Zone the VSI will be plaed into                            | Yes, inferred from subnet |  |

### IBM Cloud `transit_gateway`
Connects one or more VPCs to each other.

```
transit_gateway:
- name: sample-tgw
  location: eu-de
  connections:
  - vpc: other-vpc
  - vpc: sample
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the transit gateway                                          | Yes       |  |
| location | IBM Cloud location of the transit gateway                            | Yes       |  |
| connections | Defines which VPCs must be included in the transit gateway        | Yes       |  |
| connection.vpc | Defines the VPC to include. Every VPC must exist in the configuration, even if not managed by this configuration. When referencing an existing VPC, make sure that there is a `vpc` object of that name with `managed` set to `False`.  | Yes       | Existing `vpc` |

### IBM Cloud `nfs_server`
Defines a Virtual Server Instance within the VPC that will be used as an NFS server.

```
nfs_server:
- name: sample-nfs
  infrastructure:
    keys:
      - "vsi-access"
    image: ibm-redhat-8-3-minimal-amd64-3
    type: vpc
    subnet: sample-subnet-zone-1
    primary_ipv4_address: 10.27.0.5
    zone: eu-de-1
    vpc_name: sample
    bastion_host: sample-bastion
    volume_selector: 1000G
    mount_path: /data
    storage_folder: /data/nfs    
  storage:
  - name: sample-nfs-data
    profile: 10iops-tier
    size: 1000
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the Virtual Server Instance                                  | Yes       |  |
| infrastructure | Infrastructure attributes                                      | Yes       |  |
| infrastructure.allow_ip_spoofing | Decide if IP spoofing is allowed for the interface or not | No | False (default), True  |
| infrastructure.keys | List of SSH keys to attach to the NFS server VSI          | Yes       | Existing `ssh_key` |
| infrastructure.image | Operating system image to be used                        | Yes | Existing image in IBM Cloud |
| infrastructure.subnet | Subnet the VSI will be connected to                     | Yes | Existing `subnet` |
| infrastructure.primary_ipv4_address | IP v4 address that will be assigned to the VSI | No | If specified, address in the `subnet` range  |
| infrastructure.vpc_name | Virtual Private Cloud this VSI belongs to              | Yes, inferred from subnet |  |
| infrastructure.zone | Zone the VSI will be plaed into                            | Yes, inferred from subnet |  |
| infrastructure.bastion_host | If the NFS Server VSI can only be reached via a bastion host, specify the VSI of the bastion | No |  |
| infrastructure.volume_selector | Value by which the empty volume will be selected for formatting | Yes |  |
| infrastructure.mount_path | Path on the NFS server that will be mounted for the data | Yes |  |
| infrastructure.storage_folder | Folder that holds the data, this will be mounted from the NFS storage class | Yes |  |
| storage | Defines storage attributes | Yes |  |
| storage.name | Name of the storage that will be configured on the IBM Cloud | Yes |  |
| storage.profile | Storage profile that will be used | Yes | 3iops-tier, 5iops-tier, 10iops-tier |
| storage.size | Size of the storage in GiB | Yes | |

### `serviceid`
Defines a iam_service_id that can be granted several role based accesss right via attaching iam_policies to it.

```
serviceid:
- name: sample-serviceid
  description: to access ibmcloud services from external
  servicekeys:
  - name: primarykey
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the serviceid                                                | Yes       |                |
| description | short description of the serviceid                                | No        |                |
| servicekeys | collection of servicekeys that should be created for the parent serviceid  | No |              |
| servicekeys.name | Name of the servicekey                                       | Yes       |                |

### `cos`
Defines a Cloud Object Storage instance and allows to create buckets.

```
cos:
- name: mwdev-cos
  plan: standard
  location: global
  serviceids:
  - name: mwdev-cos-serviceid
    roles: ["Manager", "Viewer", "Administrator"]
  buckets:
  - name: bucketone6c9d6840
    cross_region_location: eu
```

#### Property explanation
| Property | Description                                                                         | Mandatory | Allowed values |
| -------- | ----------------------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the serviceid                                                               | Yes       |                |
| plan | short description of the serviceid                                                      | Yes       |                |
| location | collection of servicekeys that should be created for the parent serviceid           | Yes       |                |
| serviceids | Collection of references to defined seriveids                                     | No        |                |
| serviceids.name | Name of the serviceid                                                        | Yes       |                |
| serviceids.roles | An array of strings to define which role should be granted to the serviceid | Yes       |                |
| buckets | Collection of buckets that should be created inside the cos instance                 | No        |                |
| buckets[].name | Collection of buckets that should be created inside the cos instance            | No        |                |
| buckets[].storage_class                                                                          | No        | standard (default), vault, cold, flex, smart |
| buckets[].endpoint_type                                                                          | No        | public (default), private |
| buckets[].cross_region_location | If you use this parameter, do not set single_site_location or region_location at the same time.       | Yes (one of) | us, eu, ap  |
| buckets[].region_location       | If you set this parameter, do not set single_site_location or cross_region_location at the same time. | Yes (one of) | au-syd, eu-de, eu-gb, jp-tok, us-east, us-south, ca-tor, jp-osa, br-sao |
| buckets[].single_site_location  | If you set this parameter, do not set region_location or cross_region_location at the same time.      | Yes (one of) | ams03, che01, hkg02, mel01, mex01, mil01, mon01, osl01, par01, sjc04, sao01, seo01, sng01, and tor01  |


## vSphere

For vSphere, the following object types are supported:
* [vsphere](#vsphere-vsphere)
* [vm_definition](#vsphere-vm_definition)
* [nfs_server](#vsphere-nfs_server)

### vSphere `vsphere`
Defines the vSphere vCenter onto which OpenShift will be provisioned.

```
vsphere:
- name: sample
  vcenter: 10.99.92.13
  datacenter: Datacenter1
  datastore: Datastore1
  cluster: Cluster1
  network: "VM Network"
  folder: /Datacenter1/vm/sample
  resource_pool: gold
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the vSphere definition, will be referenced by `openshift`    | Yes       |  |
| vcenter  | Host or IP address of the vSphere Center                             | Yes       |  |
| datacenter | vSphere Data Center to be used for the virtual machines            | Yes |   |
| datastore | vSphere Data Store to be used for the virtual machines              | Yes |   |
| cluster  | vSphere cluster to be used for the virtual machines                  | Yes |   |
| network  | vSphere network to be used for the virtual machines                  | Yes |   |
| folder   | Fully qualified folder name into which the OpenShift cluster will be placed    | Yes |   |
| resource_pool | vSphere resource pool to be assigned to the virtual machines    | Yes |  |

### vSphere `vm_definition`
Defines the virtual machine properties to be used for the control-plane nodes and workers.

```
vm_definition:
- name: control-plane
  vcpu: 8
  memory_mb: 32768
  boot_disk_size_gb: 100
- name: worker
  vcpu: 16
  memory_mb: 65536
  boot_disk_size_gb: 200
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the VM definition, will be referenced by `openshift`         | Yes       |  |
| vcpu     | Number of virtual CPUs to be assigned to the VMs                     | Yes       |  |
| memory_mb | Amount of memory in MiB of the virtual machines                     | Yes |   |
| boot_disk_size_gb | Size of the virtual machine boot disk in GiB                | Yes |   |

### vSphere `nfs_server`
Defines an existing NFS server that will be used for the OpenShift NFS storage class.

```
nfs_server:
- name: sample-nfs
  infrastructure:
    host_ip: 10.99.92.31
    storage_folder: /data/nfs
```

#### Property explanation
| Property | Description                                                          | Mandatory | Allowed values |
| -------- | -------------------------------------------------------------------- | --------- | -------------- |
| name     | Name of the NFS server                                               | Yes       |  |
| infrastructure | Infrastructure attributes                                      | Yes       |  |
| infrastructure.host_ip | Host or IP address of the NFS server                   | Yes |   |
| infrastructure.storage_folder | Folder that holds the data, this will be mounted from the NFS storage class | Yes |  |

## Existing OpenShift